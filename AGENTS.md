## 対話方針
- 指示がない限り、言語は日本語を使用します。

- 次の作業手順が明確でも手戻りを減らすために、共有できていない事態や追加の変更を行った場合は、次の作業に映らず、一度確認を挟んでください。

- 作業を中断して、何も知らない他の作業者が作業を担当する可能性があります。
そのため、issueやファイルに情報を保持できる場合は、実施した簡潔な情報だけでなく、引継ぎや将来の自分のためのドキュメント整備を心がけてください。

特に、ファイルを探したり調査することになった場合は、その調査に関する情報が不足していたことを意味します。
必要に応じてCLAUDE.mdや外部に、その調査手順を簡略化できる情報を記録できるように提案してください。
ただし、ファイルの詳細や特定の問題の説明のような具体的すぎる事項ではなく、抽象化された情報であることが望ましいです。

### 言葉遣い
- わかりました！了解しました！等の返答は不要
- コードの修正に対して「問題の原因を解決しました」のような表現は使わないでください。（コードの一部の修正が実際に起きている問題とどこが関連しているかまでが明確でないと、その表現は不正確であるため）
    - さらに、確認も済んでいないにのそれらの表現は使わないでください。

## 作業方針
- 基本的には`具体的な作業手順を共有⇒処理⇒確認・修正`というフローに沿ってください。
- 次の作業手順が明確でも、手戻りを減らすために、共有できていない事態や追加の変更があった場合は、次の作業に映らず、一度確認を挟んでください。
    - 逆に、何も変わっていないことは確認しないこと。
- 複数の実現方法があるときは、相談や議論を挟むことでコードの品質が向上する可能性があります。

### 避けるべき操作
- 勝手にパッケージやライブラリ,外部のcss やjsを追加することは避けて下さい。
- ディレクトリやパス、設定ファイル、環境変数のハードコーディングは避けて下さい。
- typescriptやpythonに関して、anyを使用は可能な限り避けてください。
- pythonのdictにも注意して下さい。キーの保証が必要な場合は、dictは不適切です。型推論とも相性が悪いです。

### 意思決定
- より良い設計にするためであれば、異なる変更を提案しても構いません。(実装までが見えている場合は断るかもしれませんが、それ以外では歓迎します)
    - ただし、本来のより良い実装は、それらのどちらとも異なる可能性もあるので、選択肢から強要するような聞き方は避けてください。
- 複数の実現方法があるときは、相談や議論を挟むことでコードの品質が向上する可能性があります。
- 何が正しいかを常に考えてください。例えばコードが動作しないからと言って、そのコードを動作するように修正するのがよいとは限りません。設計の見直しをした方がこともあります。常にやりたいことと、保守性を考慮して下さい。そのうえでどの方法で修正するかの合意が必要です。
- コード動作しない場合：実行によるデバッグを行わなくても本来はコードを読めばわかります。適当にコードを書いて実行しようとするのは避けて下さい。もしわからないと思ったなら、Web等から知識の調査が必要です。

## プロジェクトの初期化
プロジェクトのCLAUDE.mdには、以下の項目の情報を記載してください。

### プロジェクトの概要
背景知識や目的を簡潔に記載してください。

### 技術スタック
フロントエンド、バックエンド、インフラ構成などで使用されているフレームワークやツールなどの情報を記載してください。

依存関係やバージョンに関する特記事項が判明すれば、その都度記入してください。
これらの項目が巨大であったり、常に必要な情報でない場合は、別のドキュメントへの移動を検討してください。

### ディレクトリ構成
プロジェクトのディレクトリ構成を記載してください。
ソースコードには依存関係が記載されているため、この情報を索引にして、必要な情報に直接ジャンプできることが重要です。

次のコマンドが役に立つかもしれません。`eza -T --git-ignore --no-filesize --no-permissions --no-user --no-time`

```
例）
prj
├── app
│   ├── src
│   └── Dockerfile
├── infra
└── docs
    └── example.yml
```

複数のコンポーネントやモジュールに分けて情報を整理することも重要なので、それらも小見出しを作って記載してください。
ただしコンポーネントが多かったり、巨大になる場合は別のドキュメントを作成してください。

### 運用手順
環境構築やテスト手順、デプロイ手順などの運用手順を記載してください。

ブランチ管理やCI/CDなどの自動化項目も含めてください。

この項目が巨大になる場合は別のドキュメント作成を提案してください。

### 命名規則や駆動開発
コーディングに関するルールを記載してください。
ルールが外部ファイルから参照できる場合は、その旨を記載するだけで構いません。


### 設計思想
このプロジェクトに新しくコードやファイルを追加する際に、守るべきルールを記載してください。

一般的な注意事項を書く必要はありません。複数の実現方法がある時にどれを選ぶべきかに関わるような背景を追記していってください。
適用範囲には注意してください。（appでは適用されるが、infraでは異なる、など）

### コード編集ツールの選択指針
Serena のmcpが利用可能な環境では、以下の使い分けが必要

**Serenaは正確な情報を補完するために使用**  
- コードベース理解（symbol検索、構造把握）
- 既存パターンの調査
- 大規模な検索・解析作業
**Claude Code標準ツール（Edit/MultiEdit/Write）を優先**
- コードの作成・編集・修正作業全般
- コードの追跡が必用ではないような単純な検索


**理由**：regex編集は予期しない箇所への変更リスクがあり、差分確認が困難。安全性と透明性を重視してClaude Code標準ツールを主軸とする。

また、作業時は常にメモリで積極的に情報を集めることを推奨します.


## GitHub PR レビューコメント詳細取得・返信

PRレビューでは「generated X comments」と表示されるが、個別のファイル・行に対するコメント詳細は別途取得が必要。

```bash
# 最新のN件のコメント詳細を取得（ファイルパス・行番号・コメント内容）
gh api repos/[owner]/[repo]/pulls/[PR番号]/comments | jq '.[-N:] | .[] | {path: .path, line: .line, body: .body}'

# コメントIDを含めて取得
gh api repos/[owner]/[repo]/pulls/[PR番号]/comments | jq '.[-N:] | .[] | {id: .id, path: .path, line: .line, body: .body}'

# 特定のコメントに返信
gh api /repos/[owner]/[repo]/pulls/[PR番号]/comments/[コメントID]/replies --method POST --raw-field body="返信内容"
```
